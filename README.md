# UPShark скрипт

Тестовый проект для практики Requests, Selenium

Требуется вэбдрайвер firefox - https://github.com/mozilla/geckodriver/releases/tag/v0.34.0

**UPShark** Скрипт для опроса ИБП фирмы Eaton серии 9000, Entel, LPM

Работает при помощи BeautifulSoup, Requests и Selenium.
Приемуществом скрипта является то, что происходит загрузка легковесного HTM документа по прямому его адресу. 

## Принцип работы 

При инициализации класса GetUPS() происходит чтение из Json файла данных о всех внесенных ибп.
Далее вызываются методы класса getEatonPage(), getEntelPage(), getLpmPage() и showReport().

### Парсинг Eaton
 - Из Json файла берется имя и адрес с портом ИБП Eaton;
 - Происходит иттерация каждого элемента словаря из Json файла;
 - При помощи Requests получается HTM-документ с ИБП по адресу *ipaddres:**port**/ups_propAlarms.htm*;
    > Если подключится к ИБП не удалось выдается ошибка "!ERROR Connection timed out"
 - Далее HTM документ парсится в методе класса **checkError_Eaton()** на наличие HTML-тэга, с классом listline1, в котором находятся информация об ошибках;
    > В тэге с классом listline0 находится шапка таблицы, возможно есть классы выше listline1,
        но программа проверяет только listline1  (т.к. по логике другие тэги уже не нужны - на ИБП уже есть аварии.)
 - Далее в пустой список добавляются вся информация из искомого тэга и их кол-во
 - Если длинна списка больше 0 выдается статус "!ERROR UPS Alarm: CHECK UPS", а если 0 "Status OK"
 
### Парсинг Entel
 - Из Json файла берется имя, адрес с портом, логин и пароль до ИБП Entel;
 - Происходит иттерация каждого элемента словаря из Json файла;
 - При помощи Requests получается HTM-документ с ИБП по адресу *ipaddres:**port**/Status.htm*;
    > Используется Basic html аутентификация.
    > Если подключится к ИБП не удалось выдается ошибка "!ERROR Connection timed out"
 - Далее HTM документ парсится в методе класса **checkError_Entel()** на наличие в тегах, с классом Tabtext, внутри тегов с совпадние со значением в строке 'UPS Normal' если совпадние обнаружена возвращается Status Ok, если нет - выдается статус "!ERROR UPS Alarm: CHECK UPS";

### Парсинг LPM 
 - Из Json файла берется имя, адрес с портом, логин и пароль до ИБП Entel;
 - Происходит иттерация каждого элемента словаря из Json файла;
 - При помощи Selenium и firefoxdriver(geckodriver) загружается страница. 
   >Selenium позволяет загрузить данные, которые выводит javascript на странице ибп
 - Далее HTM документ парсится в методе класса **checkError_Lpm()** на совпадние со значением в строке 'Онлайн' если совпадние обнаружена возвращается Status Ok, если нет - выдается статус "!ERROR UPS Alarm: CHECK UPS ";



## Структра Json-файла.
Структура Json-файла. На даннный момент структура Json файла выглядит так:

{"eaton":{
    "Какой-то ИБП":"192.168.1.0:1234"
},

"entel":{"Тест":{
    "ipaddres":"10.0.0.1:1234",
    "login":"admin",
    "password":"admin"
    }},

"lpm":{"Тест":{
    "ipaddres":"10.0.0.1:1234"
    }}

}